version: "3.8"
services:
    # --- Application Next.js ---
    sembresjero-me:
        # Build depuis le répertoire courant (cloné par Portainer ou Git)
        build:
            context: .
            dockerfile: Dockerfile
            args:
                NODE_ENV: production

        image: sembresjero-me:latest
        container_name: "sembresjero-me"
        restart: unless-stopped

        environment:
            # --- Configuration Next.js ---
            NODE_ENV: "production"
            PORT: 3000
            HOST: "0.0.0.0"

            # --- Fuseau horaire ---
            TZ: "Europe/Paris"

        networks:
            - proxy-net

        labels:
            - "com.portainer.description=Portfolio de Jérôme Sembres en Next.js depuis GitHub"
            - "com.portainer.backup=false"

        # Limites de ressources
        deploy:
            resources:
                limits:
                    cpus: "2.0"
                    memory: 2G
                reservations:
                    cpus: "0.5"
                    memory: 512M

networks:
    proxy-net:
        external: true
